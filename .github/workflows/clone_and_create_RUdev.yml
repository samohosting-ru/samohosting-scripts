name: update_dev_to_ru_dev

on:
  workflow_dispatch: 
  schedule:           
    - cron: '0 3 * * *'  

jobs:
  sync-repo:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout your repository
      uses: actions/checkout@v4
   
    - name: Setup name, email, and remote repository
      run: |
        git config user.name 'samohosting'
        git config user.email 'email@samohosting.ru'
        # git remote add samohosting-scripts https://github.com/samohosting-ru/samohosting-scripts.git

    - name: Create or update samohosting-scripts/ru_dev
      run: |
        # Fetch latest changes from dev branch
        git fetch origin samohosting-scripts ru_dev || true
        if ! git show-ref --verify --quite refs/remotes/origin/ru_dev; then  
          echo "info: ru_dev branch does not exist. Creating it from dev..."
           git checkout dev
          git checkout -b ru_dev
          git push origin ru_dev
        else
          echo "info: ru_dev branch exists. Fetching updates..."
          git checkout ru_dev
          git pull origin ru_dev
        fi

          #  Check for changes
          git fetch origin dev
        git checkout dev
        if ! git diff --quiet origin/dev origin/ru_dev; then
          echo "info: Changes detected in dev. Merging into ru_dev..."
          git checkout ru_dev
          git merge origin/dev --allow-unrelated-histories -m "Merge updates from dev into ru_dev"
          git push origin ru_dev
        else
          echo "info: No changes detected. ru_dev is up to date."
        fi



        # # echo "info: Fetched dev branch from samohosting-scripts."
        # # Check if ru_dev branch exists
        # if git ls-remote --exit-code --heads samohosting-scripts ru_dev; then
        #   echo "info: ru_dev branch exists. Checking for updates..."
        #   git fetch samohosting-scripts ru_dev
        #   git checkout ru_dev
        #   git merge samohosting-scripts/dev --allow-unrelated-histories -m "Merge updates from dev into ru_dev"
          
        #   # Check for changes
        #   if git diff --quiet; then
        #     echo "info: No changes detected. ru_dev is up to date."
        #   else
        #     echo "info: Changes detected. Committing and pushing updates to ru_dev..."
        #     git add .
        #     git commit -m "Updated ru_dev with changes from dev"
        #     git push samohosting-scripts ru_dev
        #   fi
        # else
        #   echo "info: ru_dev branch does not exist. Creating it..."
        #   git checkout -b ru_dev samohosting-scripts/dev
        #   git push -u samohosting-scripts ru_dev
        #   echo "info: Created and pushed ru_dev branch."
        # fi
